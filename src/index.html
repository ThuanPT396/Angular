<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>CallCenter</title>
  <base href="/">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <!-- Bootstrap 3.3.7 -->
  <link rel="stylesheet" href="assets/bower_components/bootstrap/dist/css/bootstrap.min.css">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="assets/bower_components/font-awesome/css/font-awesome.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt"
    crossorigin="anonymous">
  <!-- <link rel="stylesheet" href="assets/bower_components/Ionicons/css/ionicons.min.css"> -->
  <!-- jvectormap -->
  <link rel="stylesheet" href="assets/bower_components/jvectormap/jquery-jvectormap.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="assets/dist/css/AdminLTE.css">
  <!-- AdminLTE Skins. Choose a skin from the css/skins
       folder instead of downloading all of them to reduce the load. -->
  <link rel="stylesheet" href="assets/dist/css/skins/_all-skins.min.css">
  <!--Toast-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
  <link rel="manifest" href="/manifest.json">
</head>

<body class="hold-transition skin-blue sidebar-mini">
  <app-root>
    <div class="wrapper">

    </div>
  </app-root>

  <!-- jQuery 3 -->
  <script src="assets/bower_components/jquery/dist/jquery.min.js"></script>
  <!-- Bootstrap 3.3.7 -->
  <script src="assets/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
  <!-- FastClick -->
  <!-- <script src="assets/bower_components/fastclick/lib/fastclick.js"></script> -->
  <!-- AdminLTE App -->
  <!-- <script src="assets/dist/js/adminlte.min.js"></script> -->
  <!-- Sparkline -->
  <!-- <script src="assets/bower_components/jquery-sparkline/dist/jquery.sparkline.min.js"></script> -->
  <!-- jvectormap  -->
  <!-- <script src="assets/plugins/jvectormap/jquery-jvectormap-1.2.2.min.js"></script> -->
  <!-- <script src="assets/plugins/jvectormap/jquery-jvectormap-world-mill-en.js"></script> -->
  <!-- ChartJS -->
  <!-- AdminLTE for demo purposes -->
  <!-- <script src="assets/dist/js/demo.js"></script> -->
  <!--Toast-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script src="https://www.gstatic.com/firebasejs/3.9.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/3.9.0/firebase-messaging.js"></script>
  <script>
    var config = {
      apiKey: "AIzaSyDfHYz3IsP_vaUIHPtsJIoAQP2tuXt4Y3o",
      authDomain: "callcenter2-79faf.firebaseapp.com",
      databaseURL: "https://callcenter2-79faf.firebaseio.com",
      projectId: "callcenter2-79faf",
      storageBucket: "callcenter2-79faf.appspot.com",
      messagingSenderId: "437377487737"
    };
    firebase.initializeApp(config);

    const messaging = firebase.messaging();
    // navigator.serviceWorker.register('firebase-messaging-sw.js').then(function (registration) {
    //   console.log('Service Worker Registered!', registration);
    // }).catch(function (err) {
    //   console.error('Service Worker registration failed', err);
    // });
    // messaging.usePublicVapidKey("BJ8_qa62na6ICgqhhwAuETH9DvV0ZPduokYJevrolT7NR4S7mEZUinOglURS3cUgPija6ADC4XV0IRDob3kjQak");

    messaging.requestPermission().then(function () {
      console.log('Notification permission granted.');


      messaging.getToken().then(function (currentToken) {
        if (currentToken) {
          console.log(currentToken);
          sendTokenToServer(currentToken, "hoanghoa");
        } else {
          // Show permission request.
          console.log('No Instance ID token available. Request permission to generate one.');

        }
      }).catch(function (err) {
        console.log('An error occurred while retrieving token. ', err);

      });

    }).catch(function (err) {
      console.log('Unable to get permission to notify.', err);
    });

    messaging.onMessage(function (payload) {
      console.log('Message received. ', payload);
      // ...
    });

    function sendTokenToServer(token, topic) {
      var request = $.ajax({
        type: 'POST',
        // make sure you respect the same origin policy with this url:
        // http://en.wikipedia.org/wiki/Same_origin_policy
        url: 'http://27.74.245.84:8080/clinic/subscribeTopic',
        data: {
          'token': token,
          'topic': topic
        }
      });
      request.done(function (msg) {
        console.log(msg);
      });

      request.fail(function (jqXHR, textStatus) {
        console.log(jqXHR);
        console.log(textStatus);
        alert("Request failed: " + textStatus);
      });
    }
  </script>
</body>

</html>